## üîç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
![image](https://github.com/user-attachments/assets/af0e98cc-50e5-4ea4-a823-509ebb3ac836)
- ü§ñ Telegram-–±–æ—Ç: [`@buchatti_bot`](https://t.me/buchatti_bot)
- üìÅ [–ü–∞–ø–∫–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ (.xlsx)](https://disk.yandex.ru/d/5Ac0VTz1wtP_ow)
- üìä [–î–∞—à–±–æ—Ä–¥ (–∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫)](https://datalens.yandex/9iiwr4valmgav)
- üßÆ [–î–∞—à–±–æ—Ä–¥ (–∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî PostgreSQL)](https://datalens.yandex/z8fj31p2tf5el)

#### –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç—É:
- bot/modules —Å–æ–¥–µ—Ä–∂–∏—Ç –≤ —Å–µ–±–µ:
  - —Å–∫—Ä–∏–ø—Ç, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ 'handlers.py'
  - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –±–æ—Ç–∞ —Å PostgreSQL
- airflow/ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤ —Å–µ–±–µ:
  - dags/ dag-—Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
  - scripts/ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î 'init_db.py', –ø–æ–ª—É—á–µ–Ω–∏—è AIM_TOKEN 'get_iam_token.py', —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ 'export_csv_to_yadisk' (—Å—Ç–∞—Ä–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ - —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ù–ï .csv, –∞ .xlsx)
  - entrypoint.sh –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ airflow –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–≤–∫–ª—é—á–µ–Ω–∏—è) dags
- postgres/conf —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ PostgreSQL-—Å–µ—Ä–≤–µ—Ä—É 
- docker-compose.yml –∫–æ–Ω—Ñ–∏–≥–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- .github/workflows/deploy.yaml GitHub Actions (AC/ID-—Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–ø–ª–æ–µ–º)
- prepare-vm.yml –∫–æ–Ω—Ñ–∏–≥–∏ ansible (—á–∞—Å—Ç—å –¥–µ–ø–ª–æ—è -  –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker –∏ Docker Compose, –∞ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

![image](https://github.com/user-attachments/assets/319759c7-f830-4d31-87ce-a2169eda0614)

### üîß –°–µ—Ä–≤–∏—Å—ã:
#### postgres
-- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- –û–±—Ä–∞–∑: postgres:15
- –û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç: 5432
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB ‚Äî –∏–∑ .env
- –¢–æ–º–∞:
pg_data ‚Äî –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
postgres.conf –∏ pg_hba.conf ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è —Ö–æ—Å—Ç–∞ –ë–î
–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏: restart: always

#### redis
-- –ö–µ—à

- –û–±—Ä–∞–∑: redis:7
- –û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç: 6379
- –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫: always

#### telegram-bot
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–æ—Ç, –æ–±–º–µ–Ω–∏–≤–∞—é—â–∏–π—Å—è –¥–∞–Ω–Ω—ã–º–∏ —Å PostgreSQL/Redis

- –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑: ./bot/
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç .env
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: postgres, redis
- –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫: always

#### airflow-init
-- –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Airflow:

- –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
- –°–æ–∑–¥–∞–Ω–∏–µ admin-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ DAG-–æ–≤
- Dockerfile: ./airflow/airflow.Dockerfile
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: entrypoint.sh
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è: –∫ –ë–î PostgreSQL
- –ú–æ–Ω—Ç–∏—Ä—É–µ–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
DAG-–∏ ‚Üí /opt/airflow/dags
–°–∫—Ä–∏–ø—Ç—ã ‚Üí /opt/airflow/scripts
.env ‚Üí –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç: postgres

#### airflow-webserver
-- UI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Airflow

- –ü–æ—Ä—Ç: 8080
- –ö–æ–º–∞–Ω–¥–∞: webserver
- –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç —Ç–µ –∂–µ –ø–∞–ø–∫–∏, —á—Ç–æ –∏ init
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç: airflow-init

#### airflow-scheduler
-- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á Airflow

- –ö–æ–º–∞–Ω–¥–∞: scheduler
- –¢–µ –∂–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç: airflow-init
